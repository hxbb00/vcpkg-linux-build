name: Install vcpkg

# 仅支持手动触发：在 GitHub 仓库 Actions 页面点击 Run workflow 执行
on:
  workflow_dispatch:

jobs:
  build-gdal-linux:
    name: Build GDAL on Linux
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      # 安装 vcpkg 依赖工具（Linux 编译必备）
      - name: Install system dependencies
        run: |
          sudo apt update && sudo apt install -y build-essential cmake ninja-build curl zip unzip tar

      # 配置 vcpkg 环境
      - name: Set up vcpkg
        uses: lukka/run-vcpkg@v11
        with:
          vcpkgGitCommitId: 'master'  # 建议替换为稳定版本 commit id
          vcpkgDirectory: ${{ runner.workspace }}/vcpkg
          vcpkgTriplet: x64-linux

      # 安装带 PDAL 驱动的 GDAL（支持 LAS/LAZ）
      - name: Install GDAL via vcpkg
        run: vcpkg install gdal[core,pdal] --triplet x64-linux
        shell: bash

      # 验证安装结果
      - name: Verify GDAL and LAS driver
        run: |
          export PATH="$RUNNER_WORKSPACE/vcpkg/installed/x64-linux/bin:$PATH"
          # 检查 GDAL 版本
          gdalinfo --version
          # 检查 LAS 驱动是否存在
          gdalinfo --formats | grep -i LAS
          ls $RUNNER_WORKSPACE/vcpkg/installed/x64-linux
        shell: bash
